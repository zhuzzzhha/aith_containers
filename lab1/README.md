Bad practice:

1. Используем latest версию базового образа, а не фиксированную, каждая новая вышедшая версия сможет сломать нам сборку.
2. Не использована ступенчатая сборка
3. Копируем все файлы, в т.ч. requirements.txt,  что приведет к пересборкам при изменениях как исходного кода, так и при изменении зависимостей
4. Вызываем отдельный RUN для каждой операции, каждый раз создавая новый слой с увеличением числа слоев растет размер образа.
5. Делаем запуск от root, позволяя владельцу контейнера перейти на root хоста и делать все, что угодно

Размер образа - 1.18GB

Best practice:

1. Используем фиксированную версию базового образа, чтобы избежать проблем со сборкой при обновлении версий latest
2. Используем ступенчатую сборку, чтобы в финальный образ вошел только наш код, скомпилированные пакеты и установленнын зависимости. Компиляторы, исходный код зависимостей и кэш pip не попадет в финальный образ, что существенно сократит его размер.
3. Отдельным слоем копируем requilrements.txt и устанавливаем зависимости, а только затем копируем исходный код. Изменения зависимостей и кода не повлекут за собой взаимные пересборки. Если одна из частей осталась неизменна, она будет закэширована, что ускорит процесс пересборки.
4. Объединяем операции под один слой, чтобы уменьшить размер финального образа.
5. Делаем запуск от пользователя с ограниченными правами в целях безопасности.

Размер образа - 188MB


